如果实在觉得同级别分解有困难，直接调用线段划分的代码，把线段当作笔再次调用也算是一种粗略的方式。
http://m.blog.sina.com.cn/s/blog_53775d4a0102wvrv.html#page=1
同级别分解的次级别以下走势分解，未必是同级别。这就是说，对于次级别，只要有次次级别重合的三段，或者4到8段都可以。但同级别分解，只要次级别有三段重合的立刻完成，紧接下一个同级别。有三段重合意味着，三段一定不能是比如上下上，第二个上比第一个上的低点要低。
同级别分解不允许次级别5段以上，除非是没有形成本级别中枢的5段。
由此可以得出同级别分解的代码。
假设有线段划分的代码。把线段当作次次级别，然后用greedy的方法找到所有线段级别的中枢，也就是有三段重合的。这时可以允许中枢之间没有连接段，也可以允许有。之后对每个中枢，当切仅当后面的中枢跟它没有波动区间（不包含连接段，进入段）重合的时候，划归到一个走势。比如一个上涨趋势，可以有三个中枢。等第四个中枢dd不高于此趋势第三个中枢的gg，就把第四个先单独划归。此后如果第5个和第四个仍然形成上涨趋势，仍然把第四个当成盘整，第5个才允许和后面的组合成趋势。如果第5个和第四个形成趋势下跌，则允许4、5中枢归于同一下跌趋势。
按照此划分，每段包含至少一个中枢，此段高低点或者范围区间定义为其中中枢的dd，gg的最低点，最高点，也可以考虑允许次级别连接段。然后把三段范围区间有重合的组合为一个同级别的本级别即可。

相关原文回复叙述如下。
“21:44:33 只要盘整背驰，就在 i+2 为偶数时卖出，为奇数时买入。如果没有，当 i 为偶，若 Ai+3 不跌破 Ai 高点，则继续持有到 Ai+k+3 跌破 Ai+k高点后在不创新高或盘整顶背驰的 Ai+k+4 卖出，其中 k 为偶数；==有几点不解，请楼主讲一下 1、如果没有盘整背驰，当 i 为偶，若 Ai+3 跌破Ai 高点，是不是要出掉，是不是一跌破就要出掉？==除非出现小级别转大级别的 a+B`情况，跌破和盘整背驰是一回事情。2、当 i为偶，若我在 Ai 的低点买入，若 Ai+3 不跌破 Ai 高点，则继续持有到 Ai+k+3 跌破 Ai+k 高点后在不创新高或盘整顶背驰的 Ai+k+4 卖出，其中 k 为偶数；那有没有可能 Ai+k+3 直接跌破 Ai 的低点而造成亏损？==这问题和上面是一回事。 21:55:57[匿名] touchnet 21:49:04 老大，在同级别分解中，对于“盘整＋盘整＋盘整＋==-”，根据结合律，应该是可以任意组合的吧，那么这里面的每个盘整，最多可有几段？5 段？8 段？==对不起，上面的组合以及段都是指次级别而言。==同级别分解，不允许盘整里的中枢延伸，因此 3 段次级别就是了，不存在任意的问题。
[匿名] 猫猫 博主姐姐，还有这个问，麻烦你了哦假定已经存在一个上升趋势中枢 A，形成这个中枢的最后一个次级别走势直接下来，然后出现三个次级别重叠，下 A 下方形成一个新的中枢 B，那 AB 是不是已经形成一个新的下跌趋势了？还是要再在 B 下方形成一个 C 中枢才能认为形成趋势了？==这种情况其实就是 V 型转势的情况，一般都是在最高点左右分别有一个上一个下的次级别走势，然后左右对称都形成一个中枢，在大图形上，就构成类似头肩顶的走势，然后再跌破中枢下去形成新的中枢构成下跌。至于从顶上直接打破上升最后一个中枢的情况，一般情况下都会回拉过来形成大的中枢。如果连回拉都不拉，直接在下面形成中枢，而同样需要再跌破这中枢然后在下面形成第二个中枢才算下跌。但这种情况十分罕见，基本只出现在除权后。或者毁灭性利空的突发中。
”
